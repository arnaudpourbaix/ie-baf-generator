///////////////////////////////////////////////////////////////////////
// Arcane Spellcasting (mage/sorcerer/bard) 
///////////////////////////////////////////////////////////////////////
[EA=GOODCUTOFF]
[AURACLEANSING=TRUE]
[CASTER=WIZARD]
[OPTIONAL=TRUE]
[IMMUNITY_CHECK=FALSE]

// ************ BEGIN Lifesaver Spells *************************************

// Absolute Immunity
[action=SPELL(WIZARD_ABSOLUTE_IMMUNITY,,,notarget,hit);require=!*weaponProtection]

// Improved Mantle
[action=SPELL(WIZARD_IMPROVED_MANTLE,,,notarget,hit);require=!*weaponProtection]

// Mantle
[action=SPELL(WIZARD_MANTLE,,,notarget,hit);require=!*weaponProtection]

// Protection from Magical Weapons
[action=SPELL(WIZARD_PROTECTION_FROM_MAGIC_WEAPONS,,,notarget,hit);require=!*weaponProtection]

// Time Stop
[action=TIMER(ja#timestop,24),SPELL(WIZARD_TIME_STOP,,,notarget)]

// Project Image
[action=SPELL(WIZARD_PROJECT_IMAGE,,,notarget,hit);require=!*weaponProtection,*visible,!*statgt(0,PUPPETMASTERTYPE)]
[action=SPELL(WIZARD_PROJECT_IMAGE,,,notarget);require=!*spellProtection,*visible,!*statgt(0,PUPPETMASTERTYPE)]

// Mislead
[action=SPELL(WIZARD_MISLEAD,,,notarget,hit),RUN(60,nearest);require=!*weaponProtection,*visible,!*statgt(0,PUPPETMASTERTYPE)]
[action=SPELL(WIZARD_MISLEAD,,,notarget),RUN(60,nearest);require=!*spellProtection,*visible,!*statgt(0,PUPPETMASTERTYPE)]

// Shadow Door
[action=SPELL(WIZARD_SHADOW_DOOR,,,notarget,hit),RUN(60,nearest);require=!*weaponProtection,*visible]
[action=SPELL(WIZARD_SHADOW_DOOR,,,notarget),RUN(60,nearest);require=!*spellProtection,*visible]

// Invisibility
[action=SPELL(WIZARD_INVISIBILITY,,,notarget,hit),RUN(60,nearest);require=!*weaponProtection,*visible]
[action=SPELL(WIZARD_INVISIBILITY,,,notarget),RUN(60,nearest);require=!*spellProtection,*visible,*hp%lt(70)]

// Protection from Normal Weapons
[action=SPELL(WIZARD_PROTECTION_FROM_NORMAL_WEAPONS,,,notarget,hit);require=!*weaponProtection]

// Protection from Normal Missiles
[action=SPELL(WIZARD_PROTECTION_FROM_NORMAL_MISSILES,,,notarget,rangeHit);require=!*weaponProtection,!*statgt(0,SHIELDGLOBE)]

// Stone Skin
[action=SPELL(WIZARD_STONE_SKIN,,,notarget,stoneskin,hit)]

// ************ END Lifesaver Spells *************************************


// ************ BEGIN Tenser Transformation *************************************
IF
  HaveSpell(WIZARD_TENSERS_TRANSFORMATION)  
  OR(2)
    !GlobalTimerNotExpired("ja#round","LOCALS")
    CheckStatGT(Myself,0,AURACLEANSING)
  Global("ja#disable_spellcasting","LOCALS",0)
  !HaveSpell(WIZARD_PROTECTION_FROM_MAGIC_WEAPONS)
  !HaveSpell(WIZARD_STONE_SKIN)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_TENSERS_TRANSFORMATION)
    SetGlobal("ja#disable_spellcasting","LOCALS",1)
END
// ************ END Tenser Transformation *************************************



// Decide what kind of spells to cast
IF
  OR(2)
    !GlobalTimerNotExpired("ja#round","LOCALS")
    CheckStatGT(Myself,0,AURACLEANSING)
  Global("ja#disable_spellcasting","LOCALS",0)
  Global("ja#spell_type","LOCALS",0)
  OR(26)
    HaveSpell(WIZARD_TIME_STOP)
    HaveSpell(WIZARD_DRAGONS_BREATH)
    HaveSpell(WIZARD_COMET)
    HaveSpell(WIZARD_IMPRISONMENT)
    HaveSpell(WIZARD_MAZE)
    HaveSpell(WIZARD_BIGBYS_CRUSHING_HAND)
    HaveSpell(WIZARD_WAIL_OF_THE_BANSHEE)
    HaveSpell(WIZARD_POWER_WORD_KILL)
    HaveSpell(WIZARD_POWER_WORD_STUN)
    HaveSpell(WIZARD_POWER_WORD_BLIND)
    HaveSpell(WIZARD_POWER_WORD_SILENCE)
    HaveSpell(WIZARD_SYMBOL_DEATH)
    HaveSpell(WIZARD_SYMBOL_STUN)
    HaveSpell(WIZARD_SYMBOL_FEAR)
    HaveSpell(WIZARD_BIGBYS_CLENCHED_FIST)
    HaveSpell(WIZARD_PRISMATIC_SPRAY)
    HaveSpell(WIZARD_SPHERE_OF_CHAOS)
    HaveSpell(WIZARD_FINGER_OF_DEATH)
    HaveSpell(WIZARD_DEATH_SPELL)
    HaveSpell(WIZARD_DISINTEGRATE)
    HaveSpell(WIZARD_DEATH_FOG)
    HaveSpell(WIZARD_CLOUDKILL)
    HaveSpell(WIZARD_HOLD_MONSTER)
    HaveSpell(WIZARD_CHAOS)
    HaveSpell(WIZARD_FEEBLEMIND)
    HaveSpell(WIZARD_FLESH_TO_STONE)
  RandomNum(3,1)
THEN
  RESPONSE #100
    SetGlobal("ja#spell_type","LOCALS",1) // Major disabling spells
END

IF
  OR(2)
    !GlobalTimerNotExpired("ja#round","LOCALS")
    CheckStatGT(Myself,0,AURACLEANSING)
  Global("ja#disable_spellcasting","LOCALS",0)
  Global("ja#spell_type","LOCALS",0)
  OR(17)
    HaveSpell(WIZARD_SUMMON_PLANATAR_GOOD)
    HaveSpell(WIZARD_SUMMON_PLANATAR_EVIL)
    HaveSpell(WIZARD_GATE)
    HaveSpell(WIZARD_SUMMON_FIEND)
    HaveSpell(WIZARD_CACOFIEND)
    HaveSpell(WIZARD_MORDENKAINENS_SWORD)
    HaveSpell(WIZARD_SUMMON_HAKEASHAR)
    HaveSpell(WIZARD_SUMMON_NISHRUU)
    HaveSpell(WIZARD_ANIMATE_DEAD)
    HaveSpell(WIZARD_SUMMON_DJINNI)
    HaveSpell(WIZARD_SUMMON_EFREET)
    HaveSpell(WIZARD_INVISIBLE_STALKER)
    HaveSpell(WIZARD_MONSTER_SUMMONING_3)
    HaveSpell(WIZARD_WYVERN_CALL)
    HaveSpell(WIZARD_CONJURE_FIRE_ELEMENTAL)
    HaveSpell(WIZARD_CONJURE_AIR_ELEMENTAL)
    HaveSpell(WIZARD_CONJURE_EARTH_ELEMENTAL)
  RandomNum(4,1)
THEN
  RESPONSE #100
    SetGlobal("ja#spell_type","LOCALS",2) // Major summoning spells
END

IF
  OR(2)
    !GlobalTimerNotExpired("ja#round","LOCALS")
    CheckStatGT(Myself,0,AURACLEANSING)
  Global("ja#disable_spellcasting","LOCALS",0)
  Global("ja#spell_type","LOCALS",0)
  OR(12)
    HaveSpellRES("SPWI723") // Improved chaos shield
    HaveSpell(WIZARD_IMPROVED_ALUCRITY)
    HaveSpell(WIZARD_SPELL_SHIELD)
    HaveSpell(WIZARD_SIMULACRUM)
    HaveSpell(WIZARD_PROJECT_IMAGE)
    HaveSpell(WIZARD_MASS_INVISIBILITY)
    HaveSpell(WIZARD_MISLEAD)
    HaveSpell(WIZARD_SHADOW_DOOR)
    HaveSpell(WIZARD_IMPROVED_INVISIBILITY)
    HaveSpell(WIZARD_SPELL_IMMUNITY)
    HaveSpell(WIZARD_PROTECTION_FROM_ENERGY)
    HaveSpell(WIZARD_PROTECTION_FROM_THE_ELEMENTS)
    HaveSpell(WIZARD_PROTECTION_FROM_MAGIC_ENERGY)
  RandomNum(3,1)
THEN
  RESPONSE #100
    SetGlobal("ja#spell_type","LOCALS",3) // Major protection spells
END

IF
  OR(2)
    !GlobalTimerNotExpired("ja#round","LOCALS")
    CheckStatGT(Myself,0,AURACLEANSING)
  Global("ja#disable_spellcasting","LOCALS",0)
  Global("ja#spell_type","LOCALS",0)
  OR(14)
    HaveSpell(WIZARD_TRUE_SIGHT)
    HaveSpell(WIZARD_DISPEL_MAGIC)
    HaveSpell(WIZARD_TRUE_DISPEL_MAGIC)
    HaveSpell(WIZARD_SPELL_STRIKE)
    HaveSpell(WIZARD_PIERCE_SHIELD)
    HaveSpell(WIZARD_WARDING_WHIP)
    HaveSpell(WIZARD_RUBY_RAY_OF_REVERSAL)
    HaveSpell(WIZARD_PIERCE_MAGIC)
    HaveSpell(WIZARD_BREACH)
    HaveSpell(WIZARD_GREATER_MALISON)
    HaveSpell(WIZARD_SECRET_WORD)
    HaveSpell(WIZARD_DETECT_ILLUSION)
    HaveSpell(WIZARD_SPELL_THRUST)
    HaveSpell(WIZARD_DETECT_INVISIBILITY)
  RandomNum(3,1)
THEN
  RESPONSE #100
    SetGlobal("ja#spell_type","LOCALS",4) // Break defense
END

IF
  OR(2)
    !GlobalTimerNotExpired("ja#round","LOCALS")
    CheckStatGT(Myself,0,AURACLEANSING)
  Global("ja#disable_spellcasting","LOCALS",0)
  Global("ja#spell_type","LOCALS",0)
  HaveSpell(WIZARD_DOMINATION)
  RandomNum(2,1)
THEN
  RESPONSE #100
    SetGlobal("ja#spell_type","LOCALS",5) // Major charm spells
END

IF
  OR(2)
    !GlobalTimerNotExpired("ja#round","LOCALS")
    CheckStatGT(Myself,0,AURACLEANSING)
  Global("ja#disable_spellcasting","LOCALS",0)
  Global("ja#spell_type","LOCALS",0)
  !HasItemSlot(Myself,SLOT_MISC19)
  OR(3)
    HaveSpell(WIZARD_ENERGY_BLADES)
    HaveSpell(WIZARD_BLACK_BLADE_OF_DISASTER)
    HaveSpell(WIZARD_MELF_METEOR)
  RandomNum(2,1)
THEN
  RESPONSE #100
    SetGlobal("ja#spell_type","LOCALS",6) // Major weapon summoning
END

IF
  OR(2)
    !GlobalTimerNotExpired("ja#round","LOCALS")
    CheckStatGT(Myself,0,AURACLEANSING)
  Global("ja#disable_spellcasting","LOCALS",0)
  Global("ja#spell_type","LOCALS",0)
  OR(8)
    HaveSpell(WIZARD_METEOR_SWARM)
    HaveSpell(WIZARD_ENERGY_DRAIN)
    HaveSpell(WIZARD_ABI_DALZIMS_HORRID_WILTING)
    HaveSpell(WIZARD_INCENDIARY_CLOUD)
    HaveSpell(WIZARD_DELAYED_BLAST_FIREBALL)
    HaveSpell(WIZARD_CHAIN_LIGHTNING)
    HaveSpell(WIZARD_SUN_FIRE)
    HaveSpell(WIZARD_CONE_OF_COLD)
THEN
  RESPONSE #100
    SetGlobal("ja#spell_type","LOCALS",7) // Major damage spells
END

IF
  OR(2)
    !GlobalTimerNotExpired("ja#round","LOCALS")
    CheckStatGT(Myself,0,AURACLEANSING)
  Global("ja#disable_spellcasting","LOCALS",0)
  Global("ja#spell_type","LOCALS",0)
  OR(25)
    HaveSpell(WIZARD_EMOTION_HOPELESSNESS)    
    HaveSpell(WIZARD_CONFUSION)
    HaveSpell(WIZARD_TELEPORT_FIELD)
    HaveSpell(WIZARD_POLYMORPH_OTHER)
    HasItemEquiped("_WAND09",Myself) // Wand of Polymorphing
    HaveSpell(WIZARD_OTILUKES_RESILIENT_SPHERE)
    HaveSpell(WIZARD_HOLD_PERSON)
    HasItemEquiped("_WAND04",Myself) // Wand of Paralyzation
    HaveSpell(WIZARD_WEB)
    HaveSpell(WIZARD_SLOW)
    HaveSpell(WIZARD_GLITTERDUST)
    HaveSpell(WIZARD_POWER_WORD_SLEEP)
    HaveSpell(WIZARD_STINKING_CLOUD)
    HaveSpell(WIZARD_HORROR)
    HasItemEquiped("_WAND02",Myself) // Wand of Fear
    HaveSpell(WIZARD_SLEEP)
    HasItemEquiped("_WAND08",Myself) // Wand of Sleep
    HaveSpell(WIZARD_SPOOK)
    HaveSpell(WIZARD_COLOR_SPRAY)
    HaveSpell(WIZARD_RAY_OF_ENFEEBLEMENT)
    HaveSpell(WIZARD_CONTAGION)
    HaveSpell(WIZARD_HOLD_UNDEAD)
    HaveSpell(WIZARD_BLINDNESS)
    HaveSpell(WIZARD_DEAFNESS)
    HaveSpell(WIZARD_GREASE)
  RandomNum(3,1)
THEN
  RESPONSE #100
    SetGlobal("ja#spell_type","LOCALS",10) // Minor disabling spells
END

IF
  OR(2)
    !GlobalTimerNotExpired("ja#round","LOCALS")
    CheckStatGT(Myself,0,AURACLEANSING)
  Global("ja#disable_spellcasting","LOCALS",0)
  Global("ja#spell_type","LOCALS",0)
  OR(7)
    HaveSpell(WIZARD_SPIDER_SPAWN)
    HaveSpell(WIZARD_CONJURE_LESSER_FIRE_ELEMENTAL)
    HaveSpell(WIZARD_CONJURE_LESSER_AIR_ELEMENTAL)
    HaveSpell(WIZARD_CONJURE_LESSER_EARTH_ELEMENTAL)
    HaveSpell(WIZARD_MONSTER_SUMMONING_2)
    HaveSpell(WIZARD_MONSTER_SUMMONING_1)
    HasItemEquiped("_WAND10",Myself) // Wand of Monster Summoning
  RandomNum(4,1)
THEN
  RESPONSE #100
    SetGlobal("ja#spell_type","LOCALS",20) // Minor summoning spells
END

IF
  OR(2)
    !GlobalTimerNotExpired("ja#round","LOCALS")
    CheckStatGT(Myself,0,AURACLEANSING)
  Global("ja#disable_spellcasting","LOCALS",0)
  Global("ja#spell_type","LOCALS",0)
  OR(24)
    HaveSpellRES("SPWI222") // Chaos shield
    HaveSpell(WIZARD_INVISIBILITY_10_FOOT)
    HaveSpell(WIZARD_INVISIBILITY)
    HaveSpell(WIZARD_NON_DETECTION)
    HaveSpell(WIZARD_MINOR_SPELL_TURNING)
    HaveSpell(WIZARD_MINOR_GLOBE_OF_INVULNERABILITY)
    HaveSpell(WIZARD_MINOR_SPELL_DEFLECTION)
    HaveSpell(WIZARD_SPIRIT_ARMOR)
    HaveSpell(WIZARD_MIRROR_IMAGE)
    HaveSpell(WIZARD_PROTECTION_FROM_NORMAL_MISSILES)
    HaveSpell(WIZARD_PROTECTION_FROM_FIRE)
    HaveSpell(WIZARD_FIRE_SHIELD_RED)
    HaveSpell(WIZARD_FIRE_SHIELD_BLUE)
    HaveSpell(WIZARD_PROTECTION_FROM_COLD)
    HaveSpell(WIZARD_PROTECTION_FROM_ELECTRICITY)
    HaveSpell(WIZARD_PROTECTION_FROM_ACID)
    HaveSpell(WIZARD_GHOST_ARMOR)
    HaveSpell(WIZARD_RESIST_FEAR)
    HaveSpell(WIZARD_SHIELD)
    HaveSpell(WIZARD_BLUR)
    HaveSpell(WIZARD_PROTECTION_FROM_EVIL)
    HaveSpell(WIZARD_REFLECTED_IMAGE)
    HaveSpell(WIZARD_ARMOR)
    HaveSpell(WIZARD_PROTECTION_FROM_PETRIFICATION)
  RandomNum(3,1)
THEN
  RESPONSE #100
    SetGlobal("ja#spell_type","LOCALS",30)  // Minor protection spells
END

IF
  OR(2)
    !GlobalTimerNotExpired("ja#round","LOCALS")
    CheckStatGT(Myself,0,AURACLEANSING)
  Global("ja#disable_spellcasting","LOCALS",0)
  Global("ja#spell_type","LOCALS",0)
  OR(2)
    HaveSpell(WIZARD_DIRE_CHARM)
    HaveSpell(WIZARD_CHARM_PERSON)  
  RandomNum(2,1)
THEN
  RESPONSE #100
    SetGlobal("ja#spell_type","LOCALS",50) // Minor charm spells
END

IF
  OR(2)
    !GlobalTimerNotExpired("ja#round","LOCALS")
    CheckStatGT(Myself,0,AURACLEANSING)
  Global("ja#disable_spellcasting","LOCALS",0)
  Global("ja#spell_type","LOCALS",0)
  !HasItemSlot(Myself,SLOT_MISC19)
  OR(3)
    HaveSpell(WIZARD_PHANTOM_BLADE)
    HaveSpell(WIZARD_GHOUL_TOUCH)
    HaveSpell(WIZARD_CHILL_TOUCH)
  RandomNum(10,1)
THEN
  RESPONSE #100
    SetGlobal("ja#spell_type","LOCALS",60) // Minor weapon summoning
END

IF
  OR(2)
    !GlobalTimerNotExpired("ja#round","LOCALS")
    CheckStatGT(Myself,0,AURACLEANSING)
  Global("ja#disable_spellcasting","LOCALS",0)
  Global("ja#spell_type","LOCALS",0)
  OR(6)
    HaveSpell(WIZARD_IMPROVED_HASTE)
    HaveSpell(WIZARD_HASTE)
    HaveSpell(WIZARD_SHAPECHANGE)
    HaveSpell(WIZARD_TENSERS_TRANSFORMATION)  
    HaveSpell(WIZARD_POLYMORPH_SELF)
    HaveSpell(WIZARD_STRENGTH)
  RandomNum(10,1)
THEN
  RESPONSE #100
    SetGlobal("ja#spell_type","LOCALS",8) // Combat buff
END

IF
  OR(2)
    !GlobalTimerNotExpired("ja#round","LOCALS")
    CheckStatGT(Myself,0,AURACLEANSING)
  Global("ja#disable_spellcasting","LOCALS",0)
  Global("ja#spell_type","LOCALS",0)
  OR(18)
    HaveSpell(WIZARD_SKULL_TRAP)
    HaveSpell(WIZARD_FLAME_ARROW)
    HaveSpell(WIZARD_FIREBALL)
    HasItemEquiped("_WAND05",Myself) // Wand of Fire
    HaveSpell(WIZARD_ICE_STORM)
    HasItemEquiped("_WAND06",Myself) // Wand of Frost
    HaveSpell(WIZARD_LIGHTNING_BOLT)
    HasItemEquiped("_WAND07",Myself) // Wand of Lightning
    HaveSpell(WIZARD_VAMPIRIC_TOUCH)
    HaveSpell(WIZARD_AGANNAZAR_SCORCHER)
    HaveSpell(WIZARD_MELF_ACID_ARROW)
    HaveSpell(WIZARD_MAGIC_MISSILE)
    HaveSpell(WIZARD_CHROMATIC_ORB)
    HasItemEquiped("_WAND03",Myself) // Wand of Magic Missiles
    HasItemEquiped("_WAND12",Myself) // Wand of Magic Missiles
    HaveSpell(WIZARD_BURNING_HANDS)
    HaveSpell(WIZARD_SHOCKING_GRASP)
    HaveSpell(WIZARD_LARLOCH_MINOR_DRAIN)
THEN
  RESPONSE #100
    SetGlobal("ja#spell_type","LOCALS",70) // Minor damage spells
END

// Dragon Breath
[target=Summon(num:5);require=valid,!magicImmunity,!fireImmunity,$levelgt(7)]
[action=SPELL(WIZARD_DRAGONS_BREATH,1,90);target=Player;require=!magicImmunity,!fireImmunity]

// Comet
[action=SPELL(WIZARD_COMET,1,90);require=!magicImmunity,!fireImmunity]

// Imprisonment
[action=SPELL(WIZARD_IMPRISONMENT,1,90);target=Player;require=!rage,!disable]

// Maze
[action=SPELL(WIZARD_MAZE,1,90);require=!rage,!disable]

// Bigbys Crushing Hand
[action=SPELL(WIZARD_BIGBYS_CRUSHING_HAND,1,90);require=!rage,!disable,!holdImmunity]

// Wail of the Banshee
[action=SPELL(WIZARD_WAIL_OF_THE_BANSHEE,1,90,notarget);require=playerRange(20)]

// Power Word Kill
[action=SPELL(WIZARD_POWER_WORD_KILL,1,90);target=Player;require=!disable,!hpgt(60)]

// Power Word Stun
[action=SPELL(WIZARD_POWER_WORD_STUN,1,90);target=Player;require=!disable,!hpgt(59),stunImmunity]

// Power Word Blind
[action=SPELL(WIZARD_POWER_WORD_BLIND,1,90);target=Player;require=!blind]

// Power Word Silence
[action=SPELL(WIZARD_POWER_WORD_SILENCE,1,90,caster);target=Caster(num:2);require=!disable,!silence,!failure]

// Symbol, Death
[target=Summon(num:5);require=valid,!hpgt(60),!magicImmunity,!deathImmunity]
[action=SPELL(WIZARD_SYMBOL_DEATH,1,90,!range:9);target=Player;require=!hpgt(60),!magicImmunity,!deathImmunity]
[action=SPELL(WIZARD_SYMBOL_DEATH,1,90,range:9,myself);require=*hpgt(60),!hpgt(60),!magicImmunity,!deathImmunity]

// Symbol, Stun
[target=Summon(num:5);require=valid,!disable,!range(10),!magicImmunity,!stunImmunity]
[action=SPELL(WIZARD_SYMBOL_STUN,1,90),RUN(30);target=Player;require=!disable,!range(10),!magicImmunity,!stunImmunity]

// Symbol, Fear
[target=Summon(num:5);require=valid,!disable,!range(10),!magicImmunity,!fearImmunity]
[action=SPELL(WIZARD_SYMBOL_FEAR,1,90),RUN(30);target=Player;require=!disable,!range(10),!magicImmunity,!fearImmunity]

// Bigbys Clenched Fist
[action=SPELL(WIZARD_BIGBYS_CLENCHED_FIST,1,90);target=Player;require=!rage,!disable,!holdImmunity]

// Primastic Spray
[action=SPELL(WIZARD_PRISMATIC_SPRAY,1,90);target=Player;require=!disable]

// Sphere of Chaos
[action=SPELL(WIZARD_SPHERE_OF_CHAOS,1,90);require=!disable]

// Finger of Death
[action=SPELL(WIZARD_FINGER_OF_DEATH,1,90);require=!disable]

// Disintegrate
[action=SPELL(WIZARD_DISINTEGRATE,1,90);require=!disable]

// Death Spell
[target=Summon(num:5);require=valid,!magicImmunity,!disable]
[target=Player;require=!magicImmunity,!disable,$levellt(8)]
[action=SPELL(WIZARD_DEATH_SPELL,1,90);require=!magicImmunity,!disable]

// Death Fog
[action=SPELL(WIZARD_DEATH_FOG,1,90);require=!magicImmunity,!disable]

// Cloud Kill
[action=SPELL(WIZARD_CLOUDKILL,1,90);require=!magicImmunity,!disable]

// Flesh to Stone
[action=SPELL(WIZARD_FLESH_TO_STONE,1,90);target=Player;require=!magicImmunity,!disable]

// Hold Monsters
[target=Summon(num:5);require=valid,!disable,!magicImmunity,!holdImmunity]
[action=SPELL(WIZARD_HOLD_MONSTER,1,90);target=Player;require=!disable,!magicImmunity,!holdImmunity]

// Chaos
[target=Summon(num:5);require=valid,!disable,!magicImmunity,!mindImmunity]
[action=SPELL(WIZARD_CHAOS,1,90);target=Player;require=!disable,!magicImmunity,!mindImmunity]

// Feeblemind
[action=SPELL(WIZARD_FEEBLEMIND,1,90);require=!disable,!magicImmunity,!mindImmunity]

// Emotion Hopelessness 
[action=SPELL(WIZARD_EMOTION_HOPELESSNESS,10,90);require=!disable,!magicImmunity,!mindImmunity]

// Confusion
[action=SPELL(WIZARD_CONFUSION,10,90);require=!disable,!magicImmunity,!mindImmunity]

// Teleport Field
[action=SPELL(WIZARD_TELEPORT_FIELD,10,90,notarget);require=seeEnemy]

// Polymorph Other
[action=SPELL(WIZARD_POLYMORPH_OTHER,10,90);target=Player;require=!disable,!magicImmunity]
// Wand of Polymorphing 
[action=ITEM(_WAND09,10,25,equiped);require=!disable,!magicImmunity] 

// Otilukes Resilient Sphere
[action=SPELL(WIZARD_OTILUKES_RESILIENT_SPHERE,10,90);require=!disable,!magicImmunity]

// Hold Person
[target=Summon(num:5);require=valid,!disable,!magicImmunity,!holdImmunity,!globe]
[action=SPELL(WIZARD_HOLD_PERSON,10,90);target=Player;require=!disable,!magicImmunity,!holdImmunity,!globe]
// Wand of Paralyzation
[action=ITEM(_WAND04,10,25,equiped);require=!disable,!magicImmunity,!holdImmunity,!globe] 
    
// Web 
[action=SPELL(WIZARD_WEB,10,90);target=Player;require=!disable,!magicImmunity,!holdImmunity,!globe]

// Slow
[target=Summon(num:5);require=valid,!slow,!disable,!magicImmunity,!globe]
[action=SPELL(WIZARD_SLOW,10,90);target=fighter(num:2);require=!slow,!disable,!magicImmunity,!globe]

// Glitterdust
[target=Summon(num:5);require=valid,!disable,!magicImmunity,!globe]
[action=SPELL(WIZARD_GLITTERDUST,10,90);target=Player;require=!globe,!blind,!magicImmunity]

// Stinking Cloud
[action=SPELL(WIZARD_STINKING_CLOUD,10,90);require=!disable,!magicImmunity,!globe]

// Power Word Sleep
[action=SPELL(WIZARD_POWER_WORD_SLEEP,10,90);target=Player;require=!disable,!magicImmunity,!sleepImmunity,!globe,hplt(20)]

// Horror
[target=Summon(num:5);require=valid,!disable,!magicImmunity,fearImmunity,!globe]
[action=SPELL(WIZARD_HORROR,10,90);target=fighter(num:2);require=!disable,!magicImmunity,fearImmunity,!globe]
// Wand of Fear
[action=ITEM(_WAND02,10,25,equiped);require=!disable,!magicImmunity,!holdImmunity,!globe] 

// Sleep
[target=Summon(num:5);require=valid,!disable,!magicImmunity,sleepImmunity,levellt(3)]
[action=SPELL(WIZARD_SLEEP,10,90);target=Player;require=!disable,!magicImmunity,!sleepImmunity,!globe,levellt(5)]
// Wand of Sleep
[action=ITEM(_WAND08,10,25,equiped);require=!disable,!magicImmunity,!sleepImmunity,!globe,levellt(5)] 

// Spook
[action=SPELL(WIZARD_SPOOK,10,90);target=Player;require=!disable,!magicImmunity,!fearImmunity,!globe]

// Color Spray
[action=SPELL(WIZARD_SPOOK,10,90);target=Player;require=!disable,!magicImmunity,!sleepImmunity,!globe,levellt(5)]

// Ray of Enfeeblement
[action=SPELL(WIZARD_RAY_OF_ENFEEBLEMENT,10,90);target=fighter(num:2);require=!disable,!magicImmunity,!globe]

// Contagion
[action=SPELL(WIZARD_CONTAGION,10,90);target=Player;require=!disable,!magicImmunity]

// Hold Undead
[action=SPELL(WIZARD_HOLD_UNDEAD,10,90,general<UNDEAD>);target=Undead(num:5);require=!disable,!magicImmunity]

// Blindness
[action=SPELL(WIZARD_BLINDNESS,10,90);target=Player;require=!blind,!globe,!magicImmunity]

// Deafness
[action=SPELL(WIZARD_DEAFNESS,10,90);target=Caster(num:2);require=!disable,!silence,!failure,!globe,!magicImmunity]

// Grease
[action=SPELL(WIZARD_GREASE,10,90,notarget);require=seeEnemy]

// Target for summoning 
IF
  See(Myself)
  False()
THEN
  RESPONSE #100
END

[target=Player;require=valid]

// Planatar
[action=SPELL(WIZARD_SUMMON_PLANATAR_GOOD,2,90,nosee)]

// Fallen Planatar
[action=SPELL(WIZARD_SUMMON_PLANATAR_EVIL,2,90,nosee)]

// Gate
[action=SPELL(WIZARD_GATE,2,90,nosee),RUN(60);require=*pfe]

// Summon Fiend
[action=SPELL(WIZARD_SUMMON_FIEND,2,90,nosee),RUN(60);require=*pfe]

// Caco Fiend
[action=SPELL(WIZARD_CACOFIEND,2,90,nosee),RUN(60);require=*pfe]

// Mordenkainen sword
[action=SPELL(WIZARD_MORDENKAINENS_SWORD,2,90,nosee)]

// Hakeashar
[action=SPELL(WIZARD_SUMMON_HAKEASHAR,2,90,nosee)]

// Nishruu
[action=SPELL(WIZARD_SUMMON_NISHRUU,2,90,nosee)]

// Animate Dead (level 15+)
[action=SPELL(WIZARD_ANIMATE_DEAD,2,90,nosee);require=*levelgt(14)]

// Djinni
[action=SPELL(WIZARD_SUMMON_DJINNI,2,90,nosee)]

// Efreeti
[action=SPELL(WIZARD_SUMMON_EFREET,2,90,nosee)]

// Invisible Stalker
[action=SPELL(WIZARD_INVISIBLE_STALKER,2,90,nosee)]

// Monster Summoning 3
[action=SPELL(WIZARD_MONSTER_SUMMONING_3,2,90,nosee)]

// Wyvern
[action=SPELL(WIZARD_WYVERN_CALL,2,90,nosee)]

// Fire Elemental
[action=SPELL(WIZARD_CONJURE_FIRE_ELEMENTAL,2,90,nosee)]

// Earth Elemental
[action=SPELL(WIZARD_CONJURE_EARTH_ELEMENTAL,2,90,nosee)]

// Air Elemental
[action=SPELL(WIZARD_CONJURE_AIR_ELEMENTAL,2,90,nosee)]

// Spider Spawn
[action=SPELL(WIZARD_SPIDER_SPAWN,20,90,nosee)]

// Lesser Fire Elemental
[action=SPELL(WIZARD_CONJURE_LESSER_FIRE_ELEMENTAL,20,90,nosee)]

// Lesser Earth Elemental
[action=SPELL(WIZARD_CONJURE_LESSER_EARTH_ELEMENTAL,20,90,nosee)]

// Lesser Air Elemental
[action=SPELL(WIZARD_CONJURE_LESSER_AIR_ELEMENTAL,20,90,nosee)]

// Monster Summoning 2
[action=SPELL(WIZARD_MONSTER_SUMMONING_2,20,90,nosee)]

// Monster Summoning 1
[action=SPELL(WIZARD_MONSTER_SUMMONING_1,20,90,nosee)]
// Wand of Monster Summoning
[action=ITEM(_WAND10,20,25,nosee,equiped)]

// Improved chaos shield
[action=SPELL(SPWI723,3,90,notarget)]

// Improved Alacrity
[action=SPELL(WIZARD_IMPROVED_ALUCRITY,3,90,notarget);require=*stat(0,AURACLEANSING)]

// Spell Shield
[action=SPELL(WIZARD_SPELL_SHIELD,3,90,notarget)]

// Simulacrum
[action=SPELL(WIZARD_SIMULACRUM,3,90,notarget);require=*visible,!*statgt(0,PUPPETMASTERTYPE)]

// Project Image
[action=SPELL(WIZARD_PROJECT_IMAGE,3,90,notarget);require=*visible,!*statgt(0,PUPPETMASTERTYPE)]

// Mass Invisibility
[action=SPELL(WIZARD_MASS_INVISIBILITY,3,90,notarget);require=*visible]

// Mislead
[action=SPELL(WIZARD_MISLEAD,3,90,notarget);require=*visible,!*statgt(0,PUPPETMASTERTYPE)]

// Shadow Door
[action=SPELL(WIZARD_SHADOW_DOOR,3,90,notarget);require=*visible]

// Improved Invisibility
[action=SPELL(WIZARD_IMPROVED_INVISIBILITY,3,90,notarget);require=!*improvedInvisible]

// Spell Immunity : invocation
[action=SPELL(WIZARD_SPELL_IMMUNITY_INVOCATION,3,90,notarget)]

// Spell Immunity : enchantment
[action=SPELL(WIZARD_SPELL_IMMUNITY_ENCHANTMENT,3,90,notarget)]

// Spell Immunity : conjuration
[action=SPELL(WIZARD_SPELL_IMMUNITY_CONJURATION,3,90,notarget)]

// Spell Immunity : alteration
[action=SPELL(WIZARD_SPELL_IMMUNITY_ALTERATION,3,90,notarget)]

// Spell Immunity : necromancy
[action=SPELL(WIZARD_SPELL_IMMUNITY_NECROMANCY,3,90,notarget)]

// Spell Immunity : divination
[action=SPELL(WIZARD_SPELL_IMMUNITY_DIVINATION,3,90,notarget)]

// Protection from Energy
[action=SPELL(WIZARD_PROTECTION_FROM_ENERGY,3,90,notarget)]

// Protection from the Elements
[action=SPELL(WIZARD_PROTECTION_FROM_THE_ELEMENTS,3,90,notarget)]

// Protection from Magic Energy
[action=SPELL(WIZARD_PROTECTION_FROM_MAGIC_ENERGY,3,90,notarget)]

// Chaos shield
[action=SPELL(SPWI222,30,90,notarget)]

// Non Detection
[action=SPELL(WIZARD_NON_DETECTION,30,90,notarget)]

// Mirror Image
[action=SPELL(WIZARD_MIRROR_IMAGE,30,90,notarget);require=!*state(STATE_MIRRORIMAGE)]

// Invisibility 10 foot
[action=SPELL(WIZARD_INVISIBILITY_10_FOOT,30,90,notarget);require=*visible]

// Shield
[action=SPELL(WIZARD_SHIELD,30,90,notarget);require=!*stat(2,SCRIPTINGSTATE5)]

// Blur
[action=SPELL(WIZARD_BLUR,30,90,notarget)]

// Invisibility
[action=SPELL(WIZARD_INVISIBILITY,30,90,notarget);require=*visible]

// Spirit Armor
[action=SPELL(WIZARD_SPIRIT_ARMOR,30,90,notarget)]


// Fire Shield Red
[action=SPELL(WIZARD_FIRE_SHIELD_RED,30,90,notarget)]

// Fire Shield Blue
[action=SPELL(WIZARD_FIRE_SHIELD_BLUE,30,90,notarget)]

// Protection from Fire
[action=SPELL(WIZARD_PROTECTION_FROM_FIRE,30,90,notarget)]

// Protection from Cold
[action=SPELL(WIZARD_PROTECTION_FROM_COLD,30,90,notarget)]

// Protection from Electricity
[action=SPELL(WIZARD_PROTECTION_FROM_ELECTRICITY,30,90,notarget)]

// Protection from Acid
[action=SPELL(WIZARD_PROTECTION_FROM_ACID,30,90,notarget)]

// Protection from Normal Missiles
[action=SPELL(WIZARD_PROTECTION_FROM_NORMAL_MISSILES,30,90,notarget)]

// Ghost Armor
[action=SPELL(WIZARD_GHOST_ARMOR,30,90,notarget)]

// Resist Fear
[action=SPELL(WIZARD_RESIST_FEAR,30,90,notarget)]

// Protection from Evil
[action=SPELL(WIZARD_PROTECTION_FROM_EVIL,30,90,notarget);require=!*pfe]

// Reflected Image
[action=SPELL(WIZARD_REFLECTED_IMAGE,30,90,notarget);require=!*state(STATE_MIRRORIMAGE)]

// Protection from Petrification
[action=SPELL(WIZARD_PROTECTION_FROM_PETRIFICATION,30,90,notarget)]

// Armor
[action=SPELL(WIZARD_ARMOR,30,90,notarget)]

// True Sight
[action=TIMER(ja#true_sight,60),SPELL(WIZARD_TRUE_SIGHT,4,90,notarget)]

// Dispel Magic 
[action=SPELL(WIZARD_TRUE_DISPEL_MAGIC,4,90),RUN(30);target=Player;require=enchanted,!range(15)]

// Remove Magic
[action=SPELL(WIZARD_DISPEL_MAGIC,4,90);target=Player;require=enchanted]

// Spell Strike
[action=SPELL(WIZARD_SPELL_STRIKE,4,90,class<MAGE_ALL>);target=Mage;require=levelgt(6)]

// Pierce Shield
[action=SPELL(WIZARD_PIERCE_SHIELD,4,90,class<MAGE_ALL>);require=levelgt(6)]

// Khelben Warding Whip
[action=SPELL(WIZARD_WARDING_WHIP,4,90,class<MAGE_ALL>);require=levelgt(6)]

// Ruby Ray of Reversal 
[action=SPELL(WIZARD_RUBY_RAY_OF_REVERSAL,4,90,class<MAGE_ALL>);require=levelgt(6)]

// Pierce Magic 
[action=SPELL(WIZARD_PIERCE_MAGIC,4,90,class<MAGE_ALL>);require=levelgt(6)]

// Breach
[action=SPELL(WIZARD_BREACH,4,90,class<MAGE_ALL>);require=levelgt(6)]

// Secret Word
[action=SPELL(WIZARD_SECRET_WORD,4,90,class<MAGE_ALL>);require=levelgt(6)]

// Spell Thrust
[action=SPELL(WIZARD_SPELL_THRUST,4,90,class<MAGE_ALL>);require=levelgt(6)]

// Greater Malison
[action=SPELL(WIZARD_GREATER_MALISON,4,90);target=Player;require=!magicImmunity]

// Detect Illusion
[action=SPELL(WIZARD_DETECT_ILLUSION,4,90,notarget);require=illusion,range(20);target=Player1]
[action=SPELL(WIZARD_DETECT_ILLUSION,4,90,notarget);require=illusion,range(20);target=Player2]
[action=SPELL(WIZARD_DETECT_ILLUSION,4,90,notarget);require=illusion,range(20);target=Player3]
[action=SPELL(WIZARD_DETECT_ILLUSION,4,90,notarget);require=illusion,range(20);target=Player4]
[action=SPELL(WIZARD_DETECT_ILLUSION,4,90,notarget);require=illusion,range(20);target=Player5]
[action=SPELL(WIZARD_DETECT_ILLUSION,4,90,notarget);require=illusion,range(20);target=Player6]

// Detect Invisibility
[action=SPELL(WIZARD_DETECT_INVISIBILITY,4,90,notarget);require=detect,!see,range(20);target=Player1]
[action=SPELL(WIZARD_DETECT_INVISIBILITY,4,90,notarget);require=detect,!see,range(20);target=Player2]
[action=SPELL(WIZARD_DETECT_INVISIBILITY,4,90,notarget);require=detect,!see,range(20);target=Player3]
[action=SPELL(WIZARD_DETECT_INVISIBILITY,4,90,notarget);require=detect,!see,range(20);target=Player4]
[action=SPELL(WIZARD_DETECT_INVISIBILITY,4,90,notarget);require=detect,!see,range(20);target=Player5]
[action=SPELL(WIZARD_DETECT_INVISIBILITY,4,90,notarget);require=detect,!see,range(20);target=Player6]

// Domination
[action=SPELL(WIZARD_DOMINATION,5,90,fighter);target=Fighter;require=!rage,!disable,!magicImmunity,!mindImmunity,!charmImmunity]

// Dire Charm
[action=SPELL(WIZARD_DIRE_CHARM,50,90,fighter);target=Fighter;require=!rage,!disable,!magicImmunity,!mindImmunity,!charmImmunity,!globe]

// Charm Person 
[action=SPELL(WIZARD_CHARM_PERSON,50,90,fighter);target=Fighter;require=!rage,!disable,!magicImmunity,!mindImmunity,!charmImmunity,!globe]

// Energy Blades
[action=SPELL(WIZARD_ENERGY_BLADES,6,90,notarget);require=!*magicalWeaponItem]

// Black Blade of Disaster
[action=SPELL(WIZARD_BLACK_BLADE_OF_DISASTER,6,90,notarget);require=!*magicalWeaponItem]

// Melf Meteor
[action=SPELL(WIZARD_MELF_METEOR,6,90,notarget);require=!*magicalWeaponItem]

// Phantom Blade
[action=SPELL(WIZARD_PHANTOM_BLADE,60,90,notarget);require=!*magicalWeaponItem]

// Ghoul Touch
[action=SPELL(WIZARD_GHOUL_TOUCH,60,90,notarget);require=!*magicalWeaponItem]

// Chill Touch
[action=SPELL(WIZARD_CHILL_TOUCH,60,90,notarget);require=!*magicalWeaponItem]

// Meteor Swarm
[target=Summon(num:5);require=valid,!magicImmunity,!fireImmunity,$levelgt(7)]
[action=SPELL(WIZARD_METEOR_SWARM,7,90);target=Player;require=!magicImmunity,!fireImmunity]

// Energy Drain
[action=SPELL(WIZARD_ENERGY_DRAIN,7,90);target=Player;require=!magicImmunity]

// Abi Dalzims Horrid Wilting
[target=Summon(num:5);require=valid,!magicImmunity,$levelgt(7)]
[action=SPELL(WIZARD_ABI_DALZIMS_HORRID_WILTING,7,90);target=Player;require=!magicImmunity]

// Incendiary Cloud
[target=Summon(num:5);require=valid,!magicImmunity,!fireImmunity,$levelgt(7)]
[action=SPELL(WIZARD_INCENDIARY_CLOUD,7,90),RUN(60);target=Player;require=!magicImmunity,!fireImmunity]

// Delayed Blast Fireball
[action=SPELL(WIZARD_DELAYED_BLAST_FIREBALL,7,90),RUN(45);require=!magicImmunity,!fireImmunity]

// Chain Lightning
[target=Summon(num:5);require=valid,!magicImmunity,!electricityImmunity]
[action=SPELL(WIZARD_CHAIN_LIGHTNING,7,90);target=Player;require=!magicImmunity,!electricityImmunity]

// Sun Fire
[target=Summon(num:5);require=valid,!fireImmunity]
[action=SPELL(WIZARD_SUN_FIRE,7,90);target=Player;require=!fireImmunity]

// Cone of Cold
[target=Summon(num:5);require=valid,!magicImmunity,coldImmunity]
[action=SPELL(WIZARD_CONE_OF_COLD,7,90);target=Player;require=!magicImmunity,!coldImmunity]

// Magic Missile 
[action=SPELL(WIZARD_MAGIC_MISSILE,70,30);target=Player;require=state(STATE_MIRRORIMAGE),!globe,!shield,!magicImmunity]

// Skull Trap
[target=Summon(num:5);require=valid,!magicImmunity]
[target=Player;require=valid,!globe,!magicImmunity]
[action=SPELL(WIZARD_SKULL_TRAP,70,90);require=or(*globe,*magicDamageImmunity),!globe,!magicImmunity]
[action=SPELL(WIZARD_SKULL_TRAP,70,90),RUN(30);require=!range(14),!globe,!magicImmunity]

// Flame Arrow
[target=Summon(num:5);require=valid,!magicImmunity,!fireImmunity]
[action=SPELL(WIZARD_FLAME_ARROW,70,90);target=Player;require=!globe,!magicImmunity,!fireImmunity]

// Fireball
[action=SPELL(WIZARD_FIREBALL,70,90);require=or(*globe,*resistFire),!globe,!magicImmunity,!fireImmunity]
[action=SPELL(WIZARD_FIREBALL,70,90),RUN(30);require=!range(16),!globe,!magicImmunity,!fireImmunity]
// Wand of Fire
[action=ITEM(_WAND05,70,25,equiped);require=or(*globe,*resistFire),!globe,!magicImmunity,!fireImmunity]
[action=ITEM(_WAND05,70,25,equiped),RUN(30);require=!range(16),!globe,!magicImmunity,!fireImmunity]

// Ice Storm
[target=Summon(num:5);require=valid,!magicImmunity,!coldImmunity]
[target=Player;require=valid,!globe,!magicImmunity,!coldImmunity]
[action=SPELL(WIZARD_ICE_STORM,70,90);require=or(*globe,*resistCold),!globe,!magicImmunity,!coldImmunity]
[action=SPELL(WIZARD_ICE_STORM,70,90),RUN(45);require=!range(17),!globe,!magicImmunity,!coldImmunity]

// Wand of Frost 
[action=ITEM(_WAND06,70,25,equiped);require=!globe,!magicImmunity,!coldImmunity]
[action=ITEM(_WAND06,70,25,equiped);require=!globe,!magicImmunity,!coldImmunity]

// Lightning Bolt
[target=Summon(num:5);require=valid,!magicImmunity,!electricityImmunity]
[target=Player;require=valid,!globe,!magicImmunity,!electricityImmunity]
[action=SPELL(WIZARD_LIGHTNING_BOLT,70,90);require=or(*globe,*resistElectricity),!globe,!magicImmunity,!electricityImmunity]
[action=SPELL(WIZARD_LIGHTNING_BOLT,70,90);require=outdoor,!globe,!magicImmunity,!electricityImmunity]

// Wand of Lightning
[action=ITEM(_WAND07,70,25,equiped);require=or(*globe,*resistElectricity),!globe,!magicImmunity,!electricityImmunity]
[action=ITEM(_WAND07,70,25,equiped);require=outdoor,!globe,!magicImmunity,!electricityImmunity]

// Vampiric Touch
[target=Summon(num:5);require=valid,!magicImmunity]
[action=SPELL(WIZARD_VAMPIRIC_TOUCH,70,90);target=Player;require=!globe,!magicImmunity]

// Agannazar Scorcher
[target=Summon(num:5);require=valid,!magicImmunity,!fireImmunity]
[action=SPELL(WIZARD_AGANNAZAR_SCORCHER,70,90);target=Player;require=!globe,!magicImmunity,!fireImmunity]

// Melf Acid Arrow
[target=Summon(num:5);require=valid,!magicImmunity,!acidImmunity]
[action=SPELL(WIZARD_MELF_ACID_ARROW,70,90);target=Player;require=!globe,!magicImmunity,!acidImmunity]

// Chromatic Orb
[target=Summon(num:5);require=valid,!magicImmunity]
[action=SPELL(WIZARD_CHROMATIC_ORB,70,90);target=Player;require=!globe,!magicImmunity]

// Magic Missile 
[target=Summon(num:5);require=valid,!magicImmunity]
[action=SPELL(WIZARD_MAGIC_MISSILE,70,90);target=Player;require=!globe,!shield,!magicImmunity]
// Wand of Magic Missile
[action=ITEM(_WAND03,70,25,equiped);require=!globe,!shield,!magicImmunity]
[action=ITEM(_WAND12,70,25,equiped);require=!globe,!shield,!magicImmunity]

// Burning Hands
[target=Summon(num:5);require=valid,!magicImmunity,!fireImmunity]
[action=SPELL(WIZARD_BURNING_HANDS,70,90);target=Player;require=!globe,!magicImmunity,!fireImmunity]

// Shocking Grasp
[target=Summon(num:5);require=valid,!magicImmunity,!electricityImmunity]
[action=SPELL(WIZARD_SHOCKING_GRASP,70,90);target=Player;require=!globe,!magicImmunity,!electricityImmunity]

// Larloch Minor Drain
[target=Summon(num:5);require=valid,!magicImmunity]
[action=SPELL(WIZARD_LARLOCH_MINOR_DRAIN,70,90);target=Player;require=!globe,!magicImmunity]

// Improved Haste
[action=SPELL(WIZARD_IMPROVED_HASTE,8,90,notarget);require=!*state(STATE_HASTED)]

// Haste
[action=SPELL(WIZARD_HASTE,8,90,notarget);require=!*state(STATE_HASTED)]

// Shapechange
[action=SPELL(WIZARD_SHAPECHANGE,8,90,notarget)]

// Tenser Transformation
[action=SPELL(WIZARD_TENSERS_TRANSFORMATION,8,25,notarget)]

// Polymorph Self
[action=SPELL(WIZARD_POLYMORPH_SELF,8,90,notarget)]

// Strength
[action=SPELL(WIZARD_STRENGTH,8,90,notarget)]

// Reset spell selection
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  !Global("ja#spell_type","LOCALS",0)
THEN
  RESPONSE #100
    // no spell was cast, probably because no target was filling conditions or bad random rolls
    SetGlobal("ja#spell_type","LOCALS",0)
END








// LEVEL 1

// Blindness
[action=SPELL(WIZARD_BLINDNESS,,90);target=Player;require=!blind,!globe,!magicImmunity]

// Burning Hands
[action=SPELL(WIZARD_BURNING_HANDS,,90);target=Player;require=!globe,!magicImmunity,!fireImmunity]

// Charm Person 
[action=SPELL(WIZARD_CHARM_PERSON,,90,fighter);target=Fighter;require=!rage,!disable,!magicImmunity,!mindImmunity,!charmImmunity,!globe]

// Chill Touch
[action=SPELL(WIZARD_CHILL_TOUCH,,90,notarget);require=!*magicalWeaponItem]

// Chromatic Orb
[action=SPELL(WIZARD_CHROMATIC_ORB,,90);target=Player;require=!globe,!magicImmunity]

// Color Spray
[action=SPELL(WIZARD_SPOOK,,90);target=Player;require=!disable,!magicImmunity,!sleepImmunity,!globe,levellt(5)]

// Grease
[action=SPELL(WIZARD_GREASE,,90,notarget);require=seeEnemy]

// Larloch Minor Drain
[action=SPELL(WIZARD_LARLOCH_MINOR_DRAIN,,90);target=Player;require=!globe,!magicImmunity]

// Mage Armor
[action=SPELL(WIZARD_ARMOR,,90,notarget)]

// Magic Missile
[action=SPELL(WIZARD_MAGIC_MISSILE,,30);target=Player;require=state(STATE_MIRRORIMAGE),!globe,!shield,!magicImmunity]

// Protection from Evil
[action=SPELL(WIZARD_PROTECTION_FROM_EVIL,,90,notarget);require=!*pfe]

// Reflected Image
[action=SPELL(WIZARD_REFLECTED_IMAGE,30,90,notarget);require=!*state(STATE_MIRRORIMAGE)]

// Shield
[action=SPELL(WIZARD_SHIELD,30,90,notarget);require=!*shield]

// Shocking Grasp
[action=SPELL(WIZARD_SHOCKING_GRASP,70,90);target=Player;require=!globe,!magicImmunity,!electricityImmunity]

// Sleep
[action=SPELL(WIZARD_SLEEP,10,90);target=Player;require=!disable,!magicImmunity,!sleepImmunity,!globe,levellt(5)]

// Spook
[action=SPELL(WIZARD_SPOOK,10,90);target=Player;require=!disable,!magicImmunity,!fearImmunity,!globe]

// True Strike
[action=SPELL(SPWI111,,50,notarget)]


// LEVEL 2

// Agannazar's Scorcher 
[action=SPELL(WIZARD_AGANNAZAR_SCORCHER,70,90);target=Player;require=!globe,!magicImmunity,!fireImmunity]

// Blur
[action=SPELL(WIZARD_BLUR,30,90,notarget)]

// Chaos shield
[action=SPELL(SPWI222,30,90,notarget)]

// Deafness
[action=SPELL(WIZARD_DEAFNESS,10,90);target=Caster(num:2);require=!disable,!silence,!failure,!globe,!magicImmunity]

// Detect Invisibility
[action=SPELL(WIZARD_DETECT_INVISIBILITY,4,90,notarget);require=detect,!see,range(20);target=Player1]
[action=SPELL(WIZARD_DETECT_INVISIBILITY,4,90,notarget);require=detect,!see,range(20);target=Player2]
[action=SPELL(WIZARD_DETECT_INVISIBILITY,4,90,notarget);require=detect,!see,range(20);target=Player3]
[action=SPELL(WIZARD_DETECT_INVISIBILITY,4,90,notarget);require=detect,!see,range(20);target=Player4]
[action=SPELL(WIZARD_DETECT_INVISIBILITY,4,90,notarget);require=detect,!see,range(20);target=Player5]
[action=SPELL(WIZARD_DETECT_INVISIBILITY,4,90,notarget);require=detect,!see,range(20);target=Player6]

// Ghoul Touch
[action=SPELL(WIZARD_GHOUL_TOUCH,60,90,notarget);require=!*magicalWeaponItem]

// Glitterdust
[action=SPELL(WIZARD_GLITTERDUST,10,90);target=Player;require=!globe,!blind,!magicImmunity]

// Horror
[action=SPELL(WIZARD_HORROR,10,90);target=fighter(num:2);require=!disable,!magicImmunity,fearImmunity,!globe]

// Invisibility
[action=SPELL(WIZARD_INVISIBILITY,,,notarget,hit),RUN(60,nearest);require=!*weaponProtection,*visible]
[action=SPELL(WIZARD_INVISIBILITY,,,notarget),RUN(60,nearest);require=!*spellProtection,*visible,*hp%lt(70)]

// Knock
[action=SPELL(SPWI207,,50);target=Player]

// Know Opponent 
[action=SPELL(SPWI208,,50);require=!magicImmunity,!globe]

// Melf Acid Arrow
[action=SPELL(WIZARD_MELF_ACID_ARROW,70,90);target=Player;require=!globe,!magicImmunity,!acidImmunity]

// Mirror Image
[action=SPELL(WIZARD_MIRROR_IMAGE,30,90,notarget);require=!*state(STATE_MIRRORIMAGE)]

// Power Word Sleep
[action=SPELL(WIZARD_POWER_WORD_SLEEP,10,90);target=Player;require=!disable,!magicImmunity,!sleepImmunity,!globe,hplt(20)]

// Ray of Enfeeblement
[action=SPELL(WIZARD_RAY_OF_ENFEEBLEMENT,10,90);target=fighter(num:2);require=!disable,!magicImmunity,!globe]

// Resist Fear
[action=SPELL(WIZARD_RESIST_FEAR,30,90,notarget)]

// Stinking Cloud
[action=SPELL(WIZARD_STINKING_CLOUD,10,90);require=!disable,!magicImmunity,!globe]

// Strength
[action=SPELL(WIZARD_STRENGTH,8,90,notarget)]

// Vocalize 
[action=SPELL(WIZARD_VOCALIZE,8,90,notarget)]

// Web 
[action=SPELL(WIZARD_WEB,10,90);target=Player;require=!disable,!magicImmunity,!globe]


// LEVEL 3

// Clairvoyance 
[action=SPELL(SPWI301,,90,notarget)]

// Detect Illusion
[action=SPELL(WIZARD_DETECT_ILLUSION,4,90,notarget);require=illusion,range(20);target=Player1]
[action=SPELL(WIZARD_DETECT_ILLUSION,4,90,notarget);require=illusion,range(20);target=Player2]
[action=SPELL(WIZARD_DETECT_ILLUSION,4,90,notarget);require=illusion,range(20);target=Player3]
[action=SPELL(WIZARD_DETECT_ILLUSION,4,90,notarget);require=illusion,range(20);target=Player4]
[action=SPELL(WIZARD_DETECT_ILLUSION,4,90,notarget);require=illusion,range(20);target=Player5]
[action=SPELL(WIZARD_DETECT_ILLUSION,4,90,notarget);require=illusion,range(20);target=Player6]

// Dire Charm
[action=SPELL(WIZARD_DIRE_CHARM,50,90,fighter);target=Fighter;require=!rage,!disable,!magicImmunity,!mindImmunity,!charmImmunity,!globe]

// Dispel Magic 
[action=SPELL(WIZARD_TRUE_DISPEL_MAGIC,4,90),RUN(30);target=Player;require=enchanted,!range(15)]

// Fireball
[action=SPELL(WIZARD_FIREBALL,70,90);require=or(*globe,*resistFire),!globe,!magicImmunity,!fireImmunity]
[action=SPELL(WIZARD_FIREBALL,70,90),RUN(30);require=!range(16),!globe,!magicImmunity,!fireImmunity]

// Flame Arrow
[action=SPELL(WIZARD_FLAME_ARROW,70,90);target=Player;require=!globe,!magicImmunity,!fireImmunity]

// Ghost Armor
[action=SPELL(WIZARD_GHOST_ARMOR,30,90,notarget)]

// Haste
[action=SPELL(WIZARD_HASTE,8,90,notarget);require=!*state(STATE_HASTED)]

// Hold Person
[action=SPELL(WIZARD_HOLD_PERSON,10,90);target=Player;require=!disable,!magicImmunity,!holdImmunity,!globe]

// Invisibility Sphere 
[action=SPELL(WIZARD_INVISIBILITY_10_FOOT,30,90,notarget);require=*visible]

// Lightning Bolt
[action=SPELL(WIZARD_LIGHTNING_BOLT,70,90);require=or(*globe,*resistElectricity),!globe,!magicImmunity,!electricityImmunity]
[action=SPELL(WIZARD_LIGHTNING_BOLT,70,90);require=outdoor,!globe,!magicImmunity,!electricityImmunity]

// Melf Meteor
[action=SPELL(WIZARD_MELF_METEOR,6,90,notarget);require=!*magicalWeaponItem]

// Minor Spell Deflection 
[action=SPELL(SPWI318,,90,notarget)]

// Monster Summoning 1
[action=SPELL(WIZARD_MONSTER_SUMMONING_1,20,90,nosee)]

// Non Detection
[action=SPELL(WIZARD_NON_DETECTION,30,90,notarget)]

// Protection from Normal Missiles
[action=SPELL(WIZARD_PROTECTION_FROM_NORMAL_MISSILES,30,90,notarget)]

// Remove Magic
[action=SPELL(WIZARD_DISPEL_MAGIC,4,90);target=Player;require=enchanted]

// Skull Trap
[action=SPELL(WIZARD_SKULL_TRAP,70,90);require=or(*globe,*magicDamageImmunity),!globe,!magicImmunity]
[action=SPELL(WIZARD_SKULL_TRAP,70,90),RUN(30);require=!range(14),!globe,!magicImmunity]

// Slow
[action=SPELL(WIZARD_SLOW,10,90);target=fighter(num:2);require=!slow,!disable,!magicImmunity,!globe]

// Spell Thrust
[action=SPELL(WIZARD_SPELL_THRUST,4,90,class<MAGE_ALL>);require=levelgt(6)]

// Vampiric Touch
[action=SPELL(WIZARD_VAMPIRIC_TOUCH,70,90);target=Player;require=!globe,!magicImmunity]


// LEVEL 4

// Confusion
[action=SPELL(WIZARD_CONFUSION,10,90);require=!disable,!magicImmunity,!mindImmunity]

// Contagion
[action=SPELL(WIZARD_CONTAGION,10,90);target=Player;require=!disable,!magicImmunity]

// Dimension Door 
[action=SPELL(SPWI402,,90,notarget)]

// Emotion: Despair 
[action=SPELL(WIZARD_EMOTION_HOPELESSNESS,10,90);require=!disable,!magicImmunity,!mindImmunity]

// Fire Shield (Red)
[action=SPELL(WIZARD_FIRE_SHIELD_RED,30,90,notarget)]

// Fire Shield (Blue)
[action=SPELL(WIZARD_FIRE_SHIELD_BLUE,30,90,notarget)]

// Greater Malison
[action=SPELL(WIZARD_GREATER_MALISON,4,90);target=Player;require=!magicImmunity]

// Ice Storm
[action=SPELL(WIZARD_ICE_STORM,70,90);require=or(*globe,*resistCold),!globe,!magicImmunity,!coldImmunity]
[action=SPELL(WIZARD_ICE_STORM,70,90),RUN(45);require=!range(17),!globe,!magicImmunity,!coldImmunity]

// Improved Invisibility
[action=SPELL(WIZARD_IMPROVED_INVISIBILITY,3,90,notarget);require=!*improvedInvisible]

// Minor Globe of Invulnerability 
[action=SPELL(WIZARD_MINOR_GLOBE_OF_INVULNERABILITY,,90,notarget);require=!*globe]

// Monster Summoning 2
[action=SPELL(WIZARD_MONSTER_SUMMONING_2,20,90,nosee)]

// Otilukes Resilient Sphere
[action=SPELL(WIZARD_OTILUKES_RESILIENT_SPHERE,10,90);require=!disable,!magicImmunity]

// Polymorph Other
[action=SPELL(WIZARD_POLYMORPH_OTHER,10,90);target=Player;require=!disable,!magicImmunity]

// Polymorph Self
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  OR(5)
    HaveSpellRES("SPWI495") // Sword spider
    HaveSpellRES("SPWI494") // Ogre
    HaveSpellRES("SPWI497") // Brown bear
    HaveSpellRES("SPWI496") // Mustard jelly
    HaveSpellRES("SPWI499") // Dread Wolf
  !GlobalTimerNotExpired("ja#polyform","LOCALS")
THEN
  RESPONSE #100
    SetGlobalTimer("ja#polyform","LOCALS",24)
    SetGlobalTimer("ja#round","LOCALS",6)
    ForceSpellRES("spwi495",Myself)  // Sword spider
    SetGlobal("ja#disable_spellcasting","LOCALS",1)
  RESPONSE #100
    SetGlobalTimer("ja#polyform","LOCALS",24)
    SetGlobalTimer("ja#round","LOCALS",6)
    ForceSpellRES("spwi497",Myself)  // Brown bear
    SetGlobal("ja#disable_spellcasting","LOCALS",1)
  RESPONSE #90
    SetGlobalTimer("ja#polyform","LOCALS",24)
    SetGlobalTimer("ja#round","LOCALS",6)
    ForceSpellRES("spwi494",Myself)  // Ogre
    SetGlobal("ja#disable_spellcasting","LOCALS",1)
  RESPONSE #90
    SetGlobalTimer("ja#polyform","LOCALS",24)
    SetGlobalTimer("ja#round","LOCALS",6)
    ForceSpellRES("spwi496",Myself)  // Mustard jelly
    SetGlobal("ja#disable_spellcasting","LOCALS",1)
  RESPONSE #50
    SetGlobalTimer("ja#polyform","LOCALS",24)
    SetGlobalTimer("ja#round","LOCALS",6)
    ForceSpellRES("spwi499",Myself)  // Dread Wolf
    SetGlobal("ja#disable_spellcasting","LOCALS",1)
END

// Secret Word
[action=SPELL(WIZARD_SECRET_WORD,4,90,class<MAGE_ALL>);require=levelgt(6)]

// Simbul's Spell Matrix (WIZARD_MINOR_SEQUENCER)

// Spider Spawn
[action=SPELL(WIZARD_SPIDER_SPAWN,20,90,nosee)]

// Spirit Armor
[action=SPELL(WIZARD_SPIRIT_ARMOR,30,90,notarget)]

// Stoneskin
[action=SPELL(WIZARD_STONE_SKIN,,,notarget,stoneskin,hit)]

// Teleport Field
[action=SPELL(WIZARD_TELEPORT_FIELD,10,90,notarget);require=seeEnemy]

// LEVEL 5

// Breach
[action=SPELL(WIZARD_BREACH,4,90,class<MAGE_ALL>);require=levelgt(6)]

// Chaos
[action=SPELL(WIZARD_CHAOS,1,90);target=Player;require=!disable,!magicImmunity,!mindImmunity]

// Cloud Kill
[action=SPELL(WIZARD_CLOUDKILL,1,90);require=!magicImmunity,!disable]

// Cone of Cold
[action=SPELL(WIZARD_CONE_OF_COLD,7,90);target=Player;require=!magicImmunity,!coldImmunity]

// Conjure Lesser Fire Elemental
[action=SPELL(WIZARD_CONJURE_LESSER_FIRE_ELEMENTAL,20,90,nosee)]

// Conjure Lesser Earth Elemental
[action=SPELL(WIZARD_CONJURE_LESSER_EARTH_ELEMENTAL,20,90,nosee)]

// Conjure Lesser Air Elemental
[action=SPELL(WIZARD_CONJURE_LESSER_AIR_ELEMENTAL,20,90,nosee)]

// Domination
[action=SPELL(WIZARD_DOMINATION,5,90,fighter);target=Fighter;require=!rage,!disable,!magicImmunity,!mindImmunity,!charmImmunity]

// Feeblemind
[action=SPELL(WIZARD_FEEBLEMIND,1,90);require=!disable,!magicImmunity,!mindImmunity]

// Hold Monsters
[action=SPELL(WIZARD_HOLD_MONSTER,1,90);target=Player;require=!disable,!magicImmunity,!holdImmunity]

// Minor Spell Turning 
[action=SPELL(WIZARD_MINOR_SPELL_TURNING,1,90,notarget)]

// Monster Summoning 3
[action=SPELL(WIZARD_MONSTER_SUMMONING_3,2,90,notarget)]

// Oracle 
[action=SPELL(WIZARD_ORACLE,2,90,notarget)]

// Phantom Blade
[action=SPELL(WIZARD_PHANTOM_BLADE,60,90,notarget);require=!*magicalWeaponItem]

// Protection from Fire
[action=SPELL(SPWI524,30,90,notarget)]

// Protection from Cold
[action=SPELL(SPWI525,30,90,notarget)]

// Protection from Electricity
[action=SPELL(SPWI512,30,90,notarget)]

// Protection from Acid
[action=SPELL(SPWI517,30,90,notarget)]

// Protection from Normal Weapons
[action=SPELL(WIZARD_PROTECTION_FROM_NORMAL_WEAPONS,,,notarget,hit);require=!*weaponProtection]

// Shadow Door
[action=SPELL(WIZARD_SHADOW_DOOR,,,notarget,hit),RUN(60,nearest);require=!*weaponProtection,*visible]
[action=SPELL(WIZARD_SHADOW_DOOR,,,notarget),RUN(60,nearest);require=!*spellProtection,*visible]

// Spell Immunity : invocation
[action=SPELL(WIZARD_SPELL_IMMUNITY_INVOCATION,3,90,notarget)]

// Spell Immunity : enchantment
[action=SPELL(WIZARD_SPELL_IMMUNITY_ENCHANTMENT,3,90,notarget)]

// Spell Immunity : conjuration
[action=SPELL(WIZARD_SPELL_IMMUNITY_CONJURATION,3,90,notarget)]

// Spell Immunity : alteration
[action=SPELL(WIZARD_SPELL_IMMUNITY_ALTERATION,3,90,notarget)]

// Spell Immunity : necromancy
[action=SPELL(WIZARD_SPELL_IMMUNITY_NECROMANCY,3,90,notarget)]

// Spell Immunity : divination
[action=SPELL(WIZARD_SPELL_IMMUNITY_DIVINATION,3,90,notarget)]

// Summon Shadow 
[action=SPELL(SPWI501,,90,notarget)]

// Sun Fire
[target=Summon(num:5);require=valid,!fireImmunity]
[action=SPELL(WIZARD_SUN_FIRE,7,90);target=Player;require=!fireImmunity]

// Spell Shield
[action=SPELL(WIZARD_SPELL_SHIELD,3,90,notarget)]


// LEVEL 6

// Acid Fog
[action=SPELL(WIZARD_DEATH_FOG,1,90);require=!magicImmunity,!disable]

// Chain Lightning
[action=SPELL(WIZARD_CHAIN_LIGHTNING,7,90);target=Player;require=!magicImmunity,!electricityImmunity]

// Conjure Fire Elemental
[action=SPELL(WIZARD_CONJURE_FIRE_ELEMENTAL,2,90,nosee)]

// Conjure Earth Elemental
[action=SPELL(WIZARD_CONJURE_EARTH_ELEMENTAL,2,90,nosee)]

// Conjure Air Elemental
[action=SPELL(WIZARD_CONJURE_AIR_ELEMENTAL,2,90,nosee)]

// Create Undead 
[action=SPELL(SPWI623,2,90,nosee)]

// Death Spell
[target=Summon(num:5);require=valid,!magicImmunity,!disable]
[target=Player;require=!magicImmunity,!disable,$levellt(8)]
[action=SPELL(WIZARD_DEATH_SPELL,1,90);require=!magicImmunity,!disable]

// Disintegrate
[action=SPELL(WIZARD_DISINTEGRATE,1,90);require=!disable]

// Flesh to Stone
[action=SPELL(WIZARD_FLESH_TO_STONE,1,90);target=Player;require=!magicImmunity,!disable]

// Globe of Invulnerability 
[action=SPELL(WIZARD_GLOBE_OF_INVULNERABILITY,,90,notarget);require=!*globe]

// Improved Haste
[action=SPELL(WIZARD_IMPROVED_HASTE,8,90,notarget);require=!*state(STATE_HASTED)]

// Invisible Stalker
[action=SPELL(WIZARD_INVISIBLE_STALKER,2,90,nosee)]

// Mislead
[action=SPELL(WIZARD_MISLEAD,,,notarget,hit),RUN(60,nearest);require=!*weaponProtection,*visible,!*statgt(0,PUPPETMASTERTYPE)]
[action=SPELL(WIZARD_MISLEAD,,,notarget),RUN(60,nearest);require=!*spellProtection,*visible,!*statgt(0,PUPPETMASTERTYPE)]

// Pierce Magic 
[action=SPELL(WIZARD_PIERCE_MAGIC,4,90,class<MAGE_ALL>);require=levelgt(6)]

// Power Word Silence
[action=SPELL(WIZARD_POWER_WORD_SILENCE,1,90,caster);target=Caster(num:2);require=!disable,!silence,!failure]

// Protection from Magic Energy
[action=SPELL(WIZARD_PROTECTION_FROM_MAGIC_ENERGY,3,90,notarget)]

// Protection from Magical Weapons
[action=SPELL(WIZARD_PROTECTION_FROM_MAGIC_WEAPONS,,,notarget,hit);require=!*weaponProtection]

// Spell Deflection 
[action=SPELL(SPWI618,,90,notarget)]

// Nishruu
[action=SPELL(WIZARD_SUMMON_NISHRUU,2,90,nosee)]

IF
  HaveSpell(WIZARD_TENSERS_TRANSFORMATION)  
  OR(2)
    !GlobalTimerNotExpired("ja#round","LOCALS")
    CheckStatGT(Myself,0,AURACLEANSING)
  Global("ja#disable_spellcasting","LOCALS",0)
  !HaveSpell(WIZARD_PROTECTION_FROM_MAGIC_WEAPONS)
  !HaveSpell(WIZARD_STONE_SKIN)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_TENSERS_TRANSFORMATION)
    SetGlobal("ja#disable_spellcasting","LOCALS",1)
END

// True Sight
[action=TIMER(ja#true_sight,60),SPELL(WIZARD_TRUE_SIGHT,4,90,notarget)]

// Wyvern
[action=SPELL(WIZARD_WYVERN_CALL,2,90,nosee)]


// LEVEL 7